<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nutrition Tracker â€“ JE Fitness</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="./frontend/styles/styles.css">

    <link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicons/favicon-16x16.png">
    <link rel="manifest" href="../favicons/site.webmanifest">
</head>

<body class="dashboard-page">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="../index.html">JE Fitness</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="workout-programs.html">Workout Programs</a></li>
                    <li class="nav-item"><a class="nav-link" href="schedule.html">Schedule</a></li>
                    <li class="nav-item"><a class="nav-link active" href="nutrition-tracker.html">Nutrition</a></li>
                    <li class="nav-item"><a class="nav-link" href="profile.html">Profile</a></li>
                    <li class="nav-item"><a class="nav-link" href="admin-dashboard.html">Admin</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" id="logoutButton">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container my-5">
        <div class="text-center mb-5">
            <h1 class="display-4 fw-bold text-primary mb-3">Your Nutrition Tracker</h1>
            <p class="lead text-muted">Log your meals and track your daily intake to stay on top of your goals.</p>
        </div>

        <div class="row g-4">
            <div class="col-lg-6">
                <div class="card shadow-sm p-4 h-100">
                    <h3 class="card-title fw-bold mb-4 text-primary">Log a Meal Item</h3>
                    <form id="mealLogForm">
                        <div class="mb-3">
                            <label for="logDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="logDate" value="" required>
                        </div>
                        <div class="mb-3">
                            <label for="mealType" class="form-label">Meal Type</label>
                            <select class="form-select" id="mealType" required>
                                <option value="">Select Meal Type</option>
                                <option value="breakfast">Breakfast</option>
                                <option value="lunch">Lunch</option>
                                <option value="dinner">Dinner</option>
                                <option value="snack">Snack</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="foodItem" class="form-label">Food Item</label>
                            <input type="text" class="form-control" id="foodItem" placeholder="e.g., Chicken Breast, Rice, Broccoli" required>
                        </div>
                        <div class="row mb-4">
                            <div class="col-md-3 mb-3 mb-md-0">
                                <label for="calories" class="form-label">Calories (kcal)</label>
                                <input type="number" class="form-control" id="calories" min="0" placeholder="0" required>
                            </div>
                            <div class="col-md-3 mb-3 mb-md-0">
                                <label for="protein" class="form-label">Protein (g)</label>
                                <input type="number" class="form-control" id="protein" min="0" placeholder="0" required>
                            </div>
                            <div class="col-md-3 mb-3 mb-md-0">
                                <label for="carbs" class="form-label">Carbs (g)</label>
                                <input type="number" class="form-control" id="carbs" min="0" placeholder="0" required>
                            </div>
                            <div class="col-md-3">
                                <label for="fats" class="form-label">Fats (g)</label>
                                <input type="number" class="form-control" id="fats" min="0" placeholder="0" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100"><i class="bi bi-plus-circle me-2"></i>Log Meal</button>
                    </form>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card shadow-sm p-4 h-100">
                    <h3 class="card-title fw-bold mb-4 text-success">Today's Log & Summary</h3>
                    <div class="mb-3">
                        <label for="viewDate" class="form-label">View Date</label>
                        <input type="date" class="form-control" id="viewDate" value="">
                    </div>

                    <div class="row text-center mb-4">
                        <div class="col-3">
                            <h5 class="fw-bold text-primary mb-0" id="totalCalories">0</h5>
                            <small class="text-muted">Calories</small>
                        </div>
                        <div class="col-3">
                            <h5 class="fw-bold text-success mb-0" id="totalProtein">0</h5>
                            <small class="text-muted">Protein (g)</small>
                        </div>
                        <div class="col-3">
                            <h5 class="fw-bold text-warning mb-0" id="totalCarbs">0</h5>
                            <small class="text-muted">Carbs (g)</small>
                        </div>
                        <div class="col-3">
                            <h5 class="fw-bold text-danger mb-0" id="totalFats">0</h5>
                            <small class="text-muted">Fats (g)</small>
                        </div>
                    </div>

                    <div id="mealLogDisplay" class="list-group">
                        <div class="list-group-item py-3">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1 fw-bold text-capitalize">Breakfast</h6>
                                <small class="text-muted"><i class="bi bi-trash text-danger" role="button"></i></small>
                            </div>
                            <p class="mb-1 small">Oatmeal (1 cup), Blueberries (1/2 cup), Protein Powder (1 scoop)</p>
                            <small class="text-info">280 kcal | P: 25g | C: 35g | F: 5g</small>
                        </div>
                         <div class="list-group-item py-3">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1 fw-bold text-capitalize">Lunch</h6>
                                <small class="text-muted"><i class="bi bi-trash text-danger" role="button"></i></small>
                            </div>
                            <p class="mb-1 small">Grilled Chicken Salad with Vinaigrette</p>
                            <small class="text-info">450 kcal | P: 40g | C: 20g | F: 25g</small>
                        </div>
                    </div>
                     <p class="text-center text-muted small mt-3" id="noMealsMessage" style="display: none;">No meals logged for this date yet.</p>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/logout.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mealLogForm = document.getElementById('mealLogForm');
            const logDateInput = document.getElementById('logDate');
            const viewDateInput = document.getElementById('viewDate');
            const mealLogDisplay = document.getElementById('mealLogDisplay');
            const totalCalories = document.getElementById('totalCalories');
            const totalProtein = document.getElementById('totalProtein');
            const totalCarbs = document.getElementById('totalCarbs');
            const totalFats = document.getElementById('totalFats');
            const noMealsMessage = document.getElementById('noMealsMessage');

            // Set default date for both inputs to today
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
            const dd = String(today.getDate()).padStart(2, '0');
            const todayFormatted = `${yyyy}-${mm}-${dd}`;
            logDateInput.value = todayFormatted;
            viewDateInput.value = todayFormatted;

            // --- Client-side Data Storage (for demo only) ---
            // In a real app, this data would come from/go to a backend database.
            // Using localStorage to simulate persistence across page reloads for the demo.
            let loggedMeals = JSON.parse(localStorage.getItem('nutritionMeals')) || [];

            function renderMeals(dateToView) {
                mealLogDisplay.innerHTML = ''; // Clear current display
                let dailyCalories = 0, dailyProtein = 0, dailyCarbs = 0, dailyFats = 0;
                let mealsFound = false;

                loggedMeals.filter(meal => meal.date === dateToView).forEach((meal, index) => {
                    mealsFound = true;
                    dailyCalories += parseFloat(meal.calories);
                    dailyProtein += parseFloat(meal.protein);
                    dailyCarbs += parseFloat(meal.carbs);
                    dailyFats += parseFloat(meal.fats);

                    const mealItem = document.createElement('div');
                    mealItem.classList.add('list-group-item', 'py-3');
                    mealItem.innerHTML = `
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1 fw-bold text-capitalize">${meal.mealType}</h6>
                            <small class="text-muted"><i class="bi bi-trash text-danger delete-meal" role="button" data-id="${meal.id}"></i></small>
                        </div>
                        <p class="mb-1 small">${meal.foodItem}</p>
                        <small class="text-info">${meal.calories} kcal | P: ${meal.protein}g | C: ${meal.carbs}g | F: ${meal.fats}g</small>
                    `;
                    mealLogDisplay.appendChild(mealItem);
                });

                totalCalories.textContent = dailyCalories;
                totalProtein.textContent = dailyProtein;
                totalCarbs.textContent = dailyCarbs;
                totalFats.textContent = dailyFats;

                if (!mealsFound) {
                    noMealsMessage.style.display = 'block';
                } else {
                    noMealsMessage.style.display = 'none';
                }
            }

            // Initial render for today's date
            renderMeals(todayFormatted);

            // Handle adding a new meal
            mealLogForm.addEventListener('submit', function(event) {
                event.preventDefault();

                const newMeal = {
                    id: Date.now(), // Simple unique ID for demo
                    date: logDateInput.value,
                    mealType: document.getElementById('mealType').value,
                    foodItem: document.getElementById('foodItem').value,
                    calories: parseFloat(document.getElementById('calories').value),
                    protein: parseFloat(document.getElementById('protein').value),
                    carbs: parseFloat(document.getElementById('carbs').value),
                    fats: parseFloat(document.getElementById('fats').value)
                };

                loggedMeals.push(newMeal);
                localStorage.setItem('nutritionMeals', JSON.stringify(loggedMeals)); // Save to localStorage
                renderMeals(viewDateInput.value); // Re-render the current view date
                mealLogForm.reset(); // Clear form fields
                logDateInput.value = newMeal.date; // Keep the date selected in the form
            });

            // Handle viewing meals for a different date
            viewDateInput.addEventListener('change', function() {
                renderMeals(viewDateInput.value);
            });

            // Handle deleting a meal (client-side only for demo)
            mealLogDisplay.addEventListener('click', function(event) {
                if (event.target.classList.contains('delete-meal')) {
                    const mealIdToDelete = parseInt(event.target.dataset.id);
                    loggedMeals = loggedMeals.filter(meal => meal.id !== mealIdToDelete);
                    localStorage.setItem('nutritionMeals', JSON.stringify(loggedMeals));
                    renderMeals(viewDateInput.value);
                }
            });
        });
    </script>
</body>
</html>